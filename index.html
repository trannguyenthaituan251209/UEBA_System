<!DOCTYPE html>
<html lang="en">
<head>
    <style>
      .sidebar-left ul li {
        font-family: 'Helve';
        color: #6e6d6d !important;
        font-weight: 500;
        cursor: pointer;
        transition: color 0.2s;
        font-size: 0.9rem;
      }
      .sidebar-left ul li:hover {
        color: #0ea5e9 !important;
      }
      .page { display: none; }
      .page.active { display: block; }
      #ml-anomaly-table {
        max-height: 420px;
        min-height: 220px;
        overflow-x: auto !important;
        overflow-y: auto !important;
        box-sizing: border-box;
      }
      #ml-anomaly-table table {
        min-width: 900px;
        width: max-content;
        table-layout: auto;
      }
      #ml-anomaly-table th, #ml-anomaly-table td {
        white-space: nowrap;
        padding: 6px 12px;
        text-align: center;
      }
    </style>
  <meta charset="UTF-8" />
  <title>UEBA Admin</title>
  <link rel="stylesheet" href="main.css" />

</head>
<body>
<div class="app" style="display:flex;width:100%;min-height:100vh;">
  <!-- SIDEBAR LEFT -->
  <aside class="sidebar-left">
    <!-- Logo and Company Name -->
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid #e5e7eb;">
      <img src="./assets/UEBA SYSTEM.png" alt="Logo" style="height:32px;width:32px;object-fit:contain;" />
      <span style="font-weight:bold;font-size:1rem;color:#000000;line-height:1.2;">UEBA SYSTEM</span>
    </div>  
    <div style="display: flex; align-items: center; gap: 8px;">
      <h3 style="margin:0;font-size: 0.9rem;"><b>ADMIN DASHBOARD</b></h3>
    </div>
    <ul>
      <div style="font-weight:bold;font-size:0.95em;color:#64748b;margin-bottom:8px;">Main menu</div>
      <li style="display:flex;align-items:center;gap:8px;">
        <button onclick="showPage('dashboard', event);" style="display:flex;align-items:center;gap:8px;width:100%;background:none;border:none;padding:0;margin:0;text-align:left;cursor:pointer;color:inherit;font:inherit;text-decoration:none;">
          <img src="./assets/overview.png" alt="Dashboard" style="width:18px;height:18px;object-fit:contain;">Overview
        </button>
      </li>
      <li style="display:flex;align-items:center;gap:8px;">
        <button onclick="showPage('detect', event);" style="display:flex;align-items:center;gap:8px;width:100%;background:none;border:none;padding:0;margin:0;text-align:left;cursor:pointer;color:inherit;font:inherit;text-decoration:none;">
          <img src="./assets/loupe.png" alt="Detect" style="width:18px;height:18px;object-fit:contain;">UEBA-ML<img src="./assets/new.png" alt="Detect" style="width:20px;height:20px;object-fit:contain;">
        </button>
      </li>
      <li style="display:flex;align-items:center;gap:8px;">
        <button onclick="showPage('employee', event);" style="display:flex;align-items:center;gap:8px;width:100%;background:none;border:none;padding:0;margin:0;text-align:left;cursor:pointer;color:inherit;font:inherit;text-decoration:none;">
          <img src="./assets/employee.png" alt="Employee" style="width:18px;height:18px;object-fit:contain;">Employee Manager
        </button>
      </li>
      <li style="display:flex;align-items:center;gap:8px;">
        <button onclick="showPage('database', event);" style="display:flex;align-items:center;gap:8px;width:100%;background:none;border:none;padding:0;margin:0;text-align:left;cursor:pointer;color:inherit;font:inherit;text-decoration:none;">
          <img src="./assets/database.png" alt="Database" style="width:18px;height:18px;object-fit:contain;">Database Manager
        </button>
      </li>
    </ul>
    <hr style="border:none;border-top:2px solid #e5e7eb;margin:24px 0 20px 0;" />
    <div>
      <div style="font-weight:bold;font-size:0.95em;color:#64748b;margin-bottom:8px;">Department</div>
      <ul style="list-style:none;padding-left:0;">
        <li style="color:#ffffff;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#07cdfe;"></span>IT
        </li>
        <li style="color:#ffffff;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#f59e42;"></span>Finance
        </li>
        <li style="color:#ffffff;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#10b981;"></span>HR
        </li>
        <li style="color:#ffffff;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#ef4444;"></span>Sales
        </li>
        <li style="color:#ffffff;margin-bottom:4px;display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:#a855f7;"></span>Marketing
        </li>
      </ul>
    </div>
  </aside>
  <main class="content">
    <!-- DASHBOARD -->
    <section id="dashboard" class="page active">
              <!-- Wide Card: SearchBar + Login User -->
        <div class="card wide" style="grid-column:1/-1;background:  #ffffff;display:flex;align-items:center;justify-content:space-between;gap:24px;padding:24px 32px 24px 24px;margin:16px 0 0 0;">
          <div style="flex:1;display:flex;align-items:center;gap:12px;">
            <input type="text" placeholder="Search employee, event, ..." style="width:320px;max-width:100%;padding:10px 16px;border-radius:8px;border:1px solid #d1d5db;font-size:1rem;outline:none;" />
          </div>
          <div style="display:flex;align-items:center;gap:10px;">
            <img src="./assets/user1.png" alt="User Avatar" style="width:40px;height:40px;border-radius:50%;object-fit:cover;box-shadow:0 2px 8px #0001;" />
            <div style="color:#222;font-size:1rem;">
              <div style="font-weight:500;">Welcome,</div>
              <div style="font-weight:bold;">Javiel Scott</div>
            </div>
          </div>
        </div>
        <p> </p>
      <div class="overview-row" style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;">
        <div class="card" style="background: #f8c58e;">
          <div style="font-size:0.95em;font-weight:600;">Active Database Session</div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <span style="font-size:2rem;font-weight:bold;line-height:1.1;">244</span>
            <span style="display:flex;align-items:center;font-size:0.95em;color:#888;margin-bottom:4px;gap:2px;">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="#10b981" style="margin-right:2px;"><path d="M10 16V4M10 4l-5 5M10 4l5 5" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>+4.2%</span>
          </div>
          <div style="font-size:0.85em;color:#7c5a00;">Current active sessions</div>
        </div>
        <div class="card" style="background: #8ee6fc;">
          <div style="font-size:0.95em;font-weight:600;">Sensitive Query Ratio</div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <span style="font-size:2rem;font-weight:bold;line-height:1.1;">15</span>
            <span style="display:flex;align-items:center;font-size:0.95em;color:#888;margin-bottom:4px;gap:2px;">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="#ef4444" style="margin-right:2px;"><path d="M10 4v12M10 16l-5-5M10 16l5-5" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>-1.1%</span>
          </div>
          <div style="font-size:0.85em;color:#0b5c6c;">% queries on sensitive data</div>
        </div>
        <div class="card" style="background: #f8b5da;">
          <div style="font-size:0.95em;font-weight:600;">After-hours Activity</div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <span style="font-size:2rem;font-weight:bold;line-height:1.1;">2</span>
            <span style="display:flex;align-items:center;font-size:0.95em;color:#888;margin-bottom:4px;gap:2px;">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="#10b981" style="margin-right:2px;"><path d="M10 16V4M10 4l-5 5M10 4l5 5" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>+0.8%</span>
          </div>
          <div style="font-size:0.85em;color:#a13c7c;">Events outside work hours</div>
        </div>
        <div class="card" style="background: #f0f7a4;">
          <div style="font-size:0.95em;font-weight:600;">Failed Authentication Attempts</div>
          <div style="display:flex;align-items:flex-end;gap:8px;">
            <span style="font-size:2rem;font-weight:bold;line-height:1.1;">17</span>
            <span style="display:flex;align-items:center;font-size:0.95em;color:#888;margin-bottom:4px;gap:2px;">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="#ef4444" style="margin-right:2px;"><path d="M10 4v12M10 16l-5-5M10 16l5-5" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>-0.5%</span>
          </div>
          <div style="font-size:0.85em;color:#b1a800;">Last 24h</div>
        </div>
      </div>
      <h2>Security report</h2>
      <p>   </p>
      <div class="dashboard-island" style="border: 1px solid #bac7db; border-radius: 12px; background: #ffffff; box-shadow: 0 4px 24px 0 rgba(56,189,248,0.08); padding: 32px 28px; margin-bottom: 32px;">
        <div class="grid">
          <div class="card" style="color: #000000;">Total Query Today<br><b>1,284</b></div>
          <div class="card" style="color: #000000;">Recent Query<br><b>Last 5 mins</b></div>
          <div class="card large">
            <h3>Anomaly Users</h3>
            <ul class="anomaly-users-list">
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user1.png" alt="EMP001" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Daniel Davis Scott</div>
                  <div style="font-size:0.8em;color:#888;">Data Analyst</div>
                </div>
                <span style="font-weight:bold;color:#e11d48;">0.92</span>
              </li>
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user2.png" alt="EMP014" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Marriot Haus Queen</div>
                  <div style="font-size:0.8em;color:#888;">Data Scientist</div>
                </div>
                <span style="font-weight:bold;color:#e11d48;">0.88</span>
              </li>
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user3.png" alt="EMP014" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Cristian David</div>
                  <div style="font-size:0.8em;color:#888;">Data Engineer</div>
                </div>
                <span style="font-weight:bold;color:#58e11d;">0.0012</span>
              </li>
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user4.png" alt="EMP014" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Lionel Junior</div>
                  <div style="font-size:0.8em;color:#888;">Service</div>
                </div>
                <span style="font-weight:bold;color:#58e11d;">0.0002</span>
              </li>
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user5.png" alt="EMP014" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Brian Steven</div>
                  <div style="font-size:0.8em;color:#888;">DB Admin</div>
                </div>
                <span style="font-weight:bold;color:#dee11d;">0.2004</span>
              </li>
              <li style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
                <img src="./assets/user6.png" alt="EMP014" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
                <div style="flex:1;">
                  <div style="font-weight:bold;color: #000000;">Helios Marry</div>
                  <div style="font-size:0.8em;color:#888;">DB Admin</div>
                </div>
                <span style="font-weight:bold;color:#dee11d;">0.102</span>
              </li>
            </ul>
          </div>
          <div class="card" style="color: #000000;">Total Events<br><b>18,244</b></div>
          <div class="card" style="color: #000000;">Avg Risk<br><b style="color: #fec807;">0.41</b></div>
          <div class="card wide" style="background: #ffffff;">
            <div style="font-size:1em;font-weight:600;text-align:center;margin-bottom:8px;">Top User Queries</div>
            <div style="display:flex;justify-content:center;align-items:center;">
              <canvas id="userQueryChart" width="600" height="110" style="margin:0 auto;display:block;max-width:100%"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- DETECT -->
<section id="detect" class="page">

  <!-- HEADER -->
  <div class="card detect-header-bar">
    <div class="detect-logo">
      <img src="./assets/UEBA SYSTEM.png" alt="Logo" />
    </div>
    <div class="detect-title-wrap">
      <h2 class="detect-title" style="font-size: 1.5rem;">
        <span style="font-weight:800;color:#222;">UEBA-ML</span>
        <span style="font-weight:50;color:#727272;margin-left:8px;">MLVer1 (BETA)</span>
      </h2>
      <span style="font-size:0.8rem;color:#939393;">Detect abnomaly by Machine Learning. Developed by Group 3 -FPT University Campus High Teck Park </span>
    </div>
    <div class="detect-header-actions">
      <button class="btn-refresh">Refresh</button>
      <button class="btn-export">Export As PDF</button>
      <button class="btn-share"><img src="./assets/share.png" alt="Share" style="width:18px;height:18px;object-fit:contain;"></button>
    </div>
  </div>

  <!-- GRID -->
  <div class="ml-detect-grid">

    <!-- Detection Overview -->
    <div class="card overview">
      <h3>Detection Overview</h3>
      <div id="ml-detect-overview">
      </div>
    </div>

    <!-- Anomaly Score Chart -->
    <div class="card chart">
      <h3>Anomaly Score Chart</h3>
      <div class="chart-wrap">
        <canvas id="anomalyScoreChart"></canvas>
        <div id="anomalyScoreTooltip"></div>
      </div>
      <div style="font-size: 0.6rem;color: #727272;">*NOTE: Anomaly scores are caculated by Machine Learning may not be 100% accurate and should be used as a reference. Don't rely solely on these scores for critical decisions.</div>
    </div>

    <!-- Anomaly Table -->
    <div class="card table">
      <h4>Top Anomalies</h4>
      <div id="ml-anomaly-table">
        <!-- table content -->
      </div>
      <div style="font-size: 0.6rem;color: #727272;">*NOTE: Anomaly scores are caculated by Machine Learning may not be 100% accurate and should be used as a reference. Don't rely solely on these scores for critical decisions.</div>
    </div>
        <!-- Card Train AI Model -->
        <div class="card" style="background: #e0e7ef; grid-column: span 2; min-width:260px;">
          <div style="font-size:0.95em;font-weight:600;">Train AI Model</div>
          <div id="train-model-status" style="margin:10px 0 8px 0; color:#222; font-size:1em; min-height:24px;"></div>
          <button id="btn-train-model" style="padding:8px 18px;border-radius:8px;background:#0ea5e9;color:#fff;font-weight:bold;border:none;cursor:pointer;font-size:1em;">Train</button>
        </div>
  </div>
        <div style="margin-top:40px;padding:32px 18px 18px 18px;background:#f9fafb;border-radius:12px;box-shadow:0 2px 12px #0001;max-width:100%;margin-left:auto;margin-right:auto;">
          <h3 style="font-size:2em;font-weight:bold;margin-bottom:18px;color:#1e293b;">About UEBA-ML MLVer1 (BETA)</h3>
          <div style="font-size:1rem;line-height:1.7;color:#222;max-height:800px;overflow-y:auto;">
            <p>
              The UEBA (User and Entity Behavior Analytics) <i>ML System is a comprehensive security analytics platform designed to detect, analyze, and respond to anomalous activities within enterprise databases and IT environments.</i> Leveraging advanced machine learning algorithms, the system continuously monitors user and entity behaviors, correlates events, and identifies potential threats in real time. <br><br>
              At its core, the UEBA ML System integrates both unsupervised and supervised learning models, including Isolation Forests and Random Forests, to provide robust anomaly detection. The system ingests a wide variety of data sources, such as query logs, authentication events, and employee metadata, transforming raw activity into meaningful features for analysis. These features include query frequency, sensitive data access ratios, execution times, login patterns, and more, enabling the models to learn normal behavior baselines and flag deviations.<br><br>
              The dashboard presents a multi-layered view of security posture. Key metrics such as total queries, recent activity, sensitive query ratios, after-hours events, and failed authentication attempts are visualized in real time. The anomaly score chart provides a scatter plot of user activities, highlighting outliers and risk levels, while the anomaly table lists top suspicious events with detailed context. Each anomaly is explained with risk assessment, behavioral context, and supporting evidence, empowering security teams to prioritize investigations.<br><br>
              The system supports context-aware detection, automatically generating explanations for flagged anomalies. For example, it can identify users accessing the system outside working hours, performing unusually high query volumes, or accessing sensitive data at abnormal rates. The ML models are trained on historical data and continuously updated to adapt to evolving threats, minimizing false positives and maximizing detection accuracy.<br><br>
              UEBA ML is designed for scalability and integration. It supports real-time API endpoints for anomaly detection, score charting, and context explanation, allowing seamless integration with SIEM, SOAR, and other security platforms. The backend is built with FastAPI for high performance and extensibility, while the frontend leverages modern HTML/CSS/JS for interactive visualization and responsive design.<br><br>
              Security teams benefit from actionable insights, automated risk scoring, and detailed audit trails. The system enables proactive threat hunting, compliance monitoring, and incident response, reducing dwell time and improving overall security posture. Advanced features include self-evaluation metrics (accuracy, precision, recall, F1-score), progress tracking via SSE, and export/share capabilities for reporting.<br><br>
              In summary, the UEBA ML System is a next-generation analytics solution that combines machine learning, big data, and intuitive visualization to safeguard enterprise assets. It empowers organizations to detect insider threats, data exfiltration, privilege abuse, and other advanced attacks, all while providing a user-friendly interface for monitoring, investigation, and response.<br><br>
              <b>Key Features:</b><br>
              - Real-time anomaly detection using ML models<br>
              - Contextual risk assessment and explanation<br>
              - Interactive dashboard with charts, tables, and cards<br>
              - API endpoints for integration and automation<br>
              - Support for both unsupervised and supervised learning<br>
              - Scalable backend (FastAPI) and modern frontend (HTML/CSS/JS)<br>
              - Self-evaluation and progress tracking<br>
              - Export, share, and reporting tools<br>
              - Designed for security teams, compliance, and IT operations<br><br>
              The UEBA ML System is continuously evolving, with future enhancements planned for advanced analytics, behavioral profiling, and integration with threat intelligence feeds. Its modular architecture ensures adaptability to new data sources, attack vectors, and organizational requirements.<br><br>
              <b>How It Works:</b><br>
              1. Data Ingestion: Collects query logs, authentication events, and employee data.<br>
              2. Feature Engineering: Extracts behavioral features (query count, sensitive ratio, login IPs, etc).<br>
              3. Model Training: Trains ML models to learn normal vs. abnormal patterns.<br>
              4. Real-Time Detection: Scores incoming events, flags anomalies, and generates context.<br>
              5. Visualization: Renders charts, tables, and cards for security teams.<br>
              <img src="./assets/details2.png" alt="UEBA ML Architecture" style="width:100%;max-width:600px;display:inline-block;">              
              <br>6. API Integration: Provides endpoints for automation and external systems.<br>
              <img src="./assets/details3.png" alt="UEBA ML Architecture" style="width:100%;max-width:600px;display:inline-block;">    
              <br>7. Continuous Improvement: Updates models and logic based on feedback and new threats.<br><br>
              <img src="./assets/details4.png" alt="UEBA ML Architecture" style="width:100%;max-width:600px;display:inline-block;">    
              <br><b>Use Cases:</b><br>
              - Insider threat detection<br>
              - Data exfiltration monitoring<br>
              - Privilege abuse identification<br>
              - Compliance and audit support<br>
              - Proactive threat hunting<br>
              - Security operations automation<br><br>
              <b>Technology Stack:</b><br>
              - Python (FastAPI, scikit-learn, pandas, joblib)<br>
              - HTML, CSS, JavaScript (frontend)<br>
              - SQL (data aggregation)<br>
              - RESTful APIs<br>
              - SSE (Server-Sent Events) for progress<br>
              - Modular, extensible architecture<br><br>
              <b>Benefits:</b><br>
              - Early detection of advanced threats<br>
              - Reduced false positives<br>
              - Actionable, explainable insights<br>
              - Seamless integration with existing tools<br>
              - Scalable and future-proof<br><br>
              The UEBA ML System represents a strategic investment in enterprise security, combining the power of machine learning with practical, actionable intelligence. Its intuitive dashboard and robust backend make it an essential tool for modern security teams.<br><br>
              <i>For more information, integration guides, or support, please contact your system administrator or security team.</i>
            </p>
          </div>
        </div>
</section>

    <!-- EMPLOYEE -->
    <section id="employee" class="page">
      <h2>Employee Management</h2>
      <p>(Future feature)</p>
    </section>
    <!-- DATABASE -->
    <section id="database" class="page">
      <h2>Database Management</h2>
      <p>(Future feature)</p>
    </section>
  </main>
</div>


<script src="main.js"></script>
</body>
<script>
// --- Train AI Model Card Logic ---
document.addEventListener('DOMContentLoaded', function() {
  const btnTrain = document.getElementById('btn-train-model');
  const statusDiv = document.getElementById('train-model-status');
  if (btnTrain && statusDiv) {
    btnTrain.addEventListener('click', async function() {
      btnTrain.disabled = true;
      btnTrain.innerText = 'Training...';
      statusDiv.innerHTML = '<span style="color:#0ea5e9;">Training model, please wait...</span>';
      try {
        const res = await fetch('http://127.0.0.1:8000/supervised/train', { method: 'POST' });
        const data = await res.json();
        if (data.success) {
          let scoreHtml = '';
          if (data.mean_scores) {
            scoreHtml += `<div><b>Mean Scores:</b> ${Object.entries(data.mean_scores).map(([k,v]) => `${k}: <span style='color:#16a34a;'>${(+v).toFixed(3)}</span>`).join(', ')}</div>`;
          }
          if (data.fold_scores) {
            scoreHtml += `<div style='margin-top:4px;'><b>Fold Scores:</b> <pre style='display:inline;font-size:0.95em;color:#444;'>${JSON.stringify(data.fold_scores, null, 2)}</pre></div>`;
          }
          statusDiv.innerHTML = `<span style='color:#16a34a;font-weight:bold;'>Training complete!</span><br>${scoreHtml}`;
        } else {
          statusDiv.innerHTML = `<span style='color:#e11d48;'>Error: ${data.error || 'Unknown error'}</span>`;
        }
      } catch (e) {
        statusDiv.innerHTML = `<span style='color:#e11d48;'>Error: ${e.message || e}</span>`;
      }
      btnTrain.disabled = false;
      btnTrain.innerText = 'Train';
    });
  }
});
</script>
</body>

</body>
</html>
